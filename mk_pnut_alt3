./mk_really_clean

set -xe

cp ../tcc_simple/experiments/xp_linux/artifacts/*_4.o artifacts/
cp ../tcc_simple/experiments/xp_linux/artifacts/elf_loader.exe artifacts/
cp ../tcc_simple/experiments/xp_linux/artifacts/elf_loader.exe otccelf/artifacts/elf_loader_otcc.exe
# bodge should do better name is wrong as this is not otccelf_js
cp ../tcc_simple/experiments/xp_linux/artifacts/otccelf_cc_x86_min.exe otccelf/artifacts/otccelf_js.exe
chmod +x artifacts/elf_loader.exe
chmod +x otccelf/artifacts/elf_loader_otcc.exe
chmod +x otccelf/artifacts/otccelf_js.exe

cd tcc_27

../artifacts/elf_loader.exe -l ../artifacts/libtcc1_27_4.o -l ../artifacts/tcc_27_4.o -c ./lib/libtcc1.c -o libtcc1.o
../artifacts/elf_loader.exe -l ../artifacts/libtcc1_27_4.o -l ../artifacts/tcc_27_4.o -I ../woody/usr/include/ -I include -c tcc.c -DONE_SOURCE -o tcc.o

cd ..

otccelf/tcc_wrap/tcc_wrap -v

sha256sum -c sum
